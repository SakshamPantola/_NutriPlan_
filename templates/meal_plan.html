{% extends "base.html" %}
{% block title %}Meal Plan - NutriPlan{% endblock %}

{% block content %}
<div class="layout-with-sidebar">
    <aside class="sidebar">
        <a href="{{ url_for('index') }}" class="logo" style="color: #fff;">
            <div class="logo-icon" style="background: rgba(255,255,255,0.2);">üçÉ</div>
            <span class="logo-text" style="color: #fff;">NutriPlan</span>
        </a>
        
        <nav class="sidebar-nav">
            <a href="{{ url_for('index') }}" class="sidebar-link">üè† Home</a>
            <a href="{{ url_for('meal_plan') }}" class="sidebar-link active">üìÖ Meal Plan</a>
            <a href="{{ url_for('select_dishes') }}" class="sidebar-link">üçΩÔ∏è Dishes</a>
            <a href="{{ url_for('grocery') }}" class="sidebar-link">üõí Grocery</a>
            <a href="#" class="sidebar-link">‚öôÔ∏è Settings</a>
        </nav>
        
        <a href="{{ url_for('logout') }}" class="sidebar-link" style="margin-top: auto;">üö™ Logout</a>
    </aside>

    <div class="layout-main">
        <header style="background: #fff; border-bottom: 1px solid #e0e0e0; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1 style="font-size: 20px; font-weight: 700;">Weekly Meal Plan</h1>
                <p style="font-size: 13px; color: #666;">Your personalized nutrition plan</p>
            </div>
            <a href="{{ url_for('grocery') }}" class="btn btn-accent btn-sm">üõí Grocery List</a>
        </header>

        <div style="padding: 24px; flex: 1; overflow-y: auto;">
            <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                <div>
                    {% if user_bmr %}
                    <div class="card" style="margin-bottom: 20px; background-color: #ffebee; border: 1px solid #ff8a80; border-radius: 12px; padding: 20px;">
                        <h3 style="color: #c96442; font-size: 16px; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            <span>‚ö°</span> Your Calculated BMR
                        </h3>
                        <p style="font-size: 32px; font-weight: 800; color: #d32f2f; margin: 0;">
                            {{ user_bmr }} <span style="font-size: 16px; font-weight: 400; color: #666;">kcal/day</span>
                        </p>
                        <p style="font-size: 12px; color: #757575; margin-top: 8px;">
                            This is the minimum energy your body requires to function at rest.
                        </p>
                    </div>
                    {% endif %}

                    <div class="day-tabs">
                        {% for day in ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] %}
                        <button class="day-tab {% if loop.first %}active{% endif %}" onclick="selectDay(this, {{ loop.index0 }})">{{ day }}</button>
                        {% endfor %}
                    </div>

                    <div id="weekly-meals">
                        {% for day_plan in meal_plan %}
                        <div class="day-content" id="day-{{ loop.index0 }}" style="display: {% if loop.first %}block{% else %}none{% endif %};">
                            {% for meal_type in ['Breakfast', 'Lunch', 'Dinner'] %}
                            {% set dish = day_plan[meal_type] %}
                            <div class="meal-card">
                                <img src="{{ dish.image }}" alt="{{ dish.name }}" class="meal-card-image">
                                <div class="meal-card-content">
                                    <span class="meal-type">{{ meal_type }}</span>
                                    <h3 class="meal-name">{{ dish.name }}</h3>
                                    <p class="meal-meta">{{ dish.cuisine }} ‚Ä¢ {{ dish.prep_time }}</p>
                                    <div class="meal-nutrition">
                                        <span style="color: #c96442;">üî• {{ dish.calories }} cal</span>
                                        <span style="color: #2d5a3d;">ü•© {{ dish.protein }}g</span>
                                        <span style="color: #e8a838;">üåæ {{ dish.carbs }}g</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div>
                    <div class="card" style="margin-bottom: 16px;">
                        <h3 class="card-title">Daily Average</h3>
                        <div class="nutrition-bar">
                            <div class="nutrition-bar-header">
                                <span>Calories</span>
                                <span style="color: #666;">{{ daily_avg.calories }} / {{ daily_avg.calories }} kcal</span>
                            </div>
                            <div class="nutrition-bar-track">
                                <div class="nutrition-bar-fill" style="width: 100%; background: #c96442;"></div>
                            </div>
                        </div>
                        <div class="nutrition-bar">
                            <div class="nutrition-bar-header">
                                <span>Protein</span>
                                <span style="color: #666;">{{ daily_avg.protein }}g</span>
                            </div>
                            <div class="nutrition-bar-track">
                                <div class="nutrition-bar-fill" style="width: 100%; background: #2d5a3d;"></div>
                            </div>
                        </div>
                        <div class="nutrition-bar">
                            <div class="nutrition-bar-header">
                                <span>Carbs</span>
                                <span style="color: #666;">{{ daily_avg.carbs }}g</span>
                            </div>
                            <div class="nutrition-bar-track">
                                <div class="nutrition-bar-fill" style="width: 100%; background: #e8a838;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="summary-card">
                        <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 16px;">Weekly Total</h3>
                        <div class="summary-grid">
                            <div>
                                <p class="summary-value">{{ weekly_total.calories|int }}</p>
                                <p class="summary-label">Calories</p>
                            </div>
                            <div>
                                <p class="summary-value">{{ weekly_total.protein|int }}g</p>
                                <p class="summary-label">Protein</p>
                            </div>
                            <div>
                                <p class="summary-value">{{ weekly_total.carbs|int }}g</p>
                                <p class="summary-label">Carbs</p>
                            </div>
                            <div>
                                <p class="summary-value">{{ weekly_total.fat|int }}g</p>
                                <p class="summary-label">Fat</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function selectDay(btn, index) {
    document.querySelectorAll('.day-tab').forEach(t => t.classList.remove('active'));
    btn.classList.add('active');

    document.querySelectorAll('.day-content').forEach(content => {
        content.style.display = 'none';
    });
    document.getElementById('day-' + index).style.display = 'block';
}
</script>
{% endblock %}